generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Business {
  id        String   @id @default(cuid())
  name      String
  address   String?
  logoUrl   String?
  createdAt DateTime @default(now())

  products     Product[]
  transactions Transaction[]
  receipts     ScannedReceipt[]
  chatMessages ChatMessage[]
  chatSessions ChatSession[]
}

model Product {
  id         String   @id @default(cuid())
  businessId String
  name       String
  category   String
  price      Float
  stock      Int
  createdAt  DateTime @default(now())

  business         Business          @relation(fields: [businessId], references: [id])
  transactionItems TransactionItem[]
}

model Transaction {
  id           String   @id @default(cuid())
  businessId   String
  date         DateTime
  customerName String?
  total        Float
  createdAt    DateTime @default(now())

  business Business          @relation(fields: [businessId], references: [id])
  items    TransactionItem[]
}

model TransactionItem {
  id            String @id @default(cuid())
  transactionId String
  productId     String?
  productName   String
  quantity      Int
  price         Float
  subtotal      Float

  transaction Transaction @relation(fields: [transactionId], references: [id])
  product     Product?    @relation(fields: [productId], references: [id])
}

model ScannedReceipt {
  id          String   @id @default(cuid())
  businessId  String
  imageUrl    String?
  storeName   String?
  date        DateTime?
  total       Float?
  itemsJson   String
  rawResponse String?
  createdAt   DateTime @default(now())

  business Business @relation(fields: [businessId], references: [id])
}

model ChatSession {
  id         String   @id @default(cuid())
  businessId String
  title      String   @default("Percakapan Baru")
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  business Business      @relation(fields: [businessId], references: [id])
  messages ChatMessage[]
}

model ChatMessage {
  id         String   @id @default(cuid())
  businessId String
  sessionId  String
  role       String
  content    String
  createdAt  DateTime @default(now())

  business Business    @relation(fields: [businessId], references: [id])
  session  ChatSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
}
